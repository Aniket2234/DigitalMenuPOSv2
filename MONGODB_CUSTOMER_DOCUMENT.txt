================================================================================
                    MONGODB CUSTOMER DOCUMENT STRUCTURE
                    Restaurant POS Digital Menu System
================================================================================

Database: restaurant_pos
Collection: customers

This document explains the structure of Customer documents in the MongoDB database
used by the Restaurant POS Digital Menu system.

================================================================================
CUSTOMER DOCUMENT FIELDS
================================================================================

1. _id (ObjectId)
   - Type: MongoDB ObjectId
   - Description: Unique identifier automatically generated by MongoDB for each
                  customer document
   - Purpose: Primary key for the customer record
   - Example: ObjectId("507f1f77bcf86cd799439011")
   - Auto-generated: Yes
   - Required: Yes (automatically set by MongoDB)

2. name (String)
   - Type: String
   - Description: Customer's full name as provided during registration
   - Purpose: Personalization and identification of the customer
   - Validation: Minimum 1 character required
   - Example: "John Doe"
   - Required: Yes
   - Notes: Can be updated by the customer after initial registration

3. phoneNumber (String)
   - Type: String
   - Description: Customer's mobile phone number used for authentication and
                  identification
   - Purpose: Unique identifier for customer login and contact
   - Validation: Must be at least 10 digits, only numeric characters allowed
   - Example: "9876543210"
   - Required: Yes
   - Unique: Yes (used as the primary lookup key)
   - Notes: This is the login credential for customers accessing the digital menu

4. visitCount (Number)
   - Type: Number (Integer)
   - Description: Tracks the number of times the customer has visited and used
                  the digital menu system
   - Purpose: Customer engagement tracking and analytics
   - Default: 1 (set when customer first registers)
   - Example: 15
   - Required: Yes
   - Auto-updated: Yes (incremented when appropriate visit conditions are met)
   - Notes: Includes visit protection logic to prevent multiple increments within
            a 5-hour window

5. favorites (Array of Strings)
   - Type: Array of String
   - Description: List of menu item IDs that the customer has ordered, used to
                  track ordering patterns
   - Purpose: Generate "Most Ordered Items" recommendations and personalization
   - Default: [] (empty array for new customers)
   - Example: ["673b2f4a8b1234567890abcd", "673b2f4a8b1234567890abce"]
   - Required: Yes (but can be empty)
   - Auto-updated: Yes (updated when customer places orders)
   - Notes: Each menu item ID may appear multiple times, with frequency indicating
            how often the item was ordered

6. firstVisit (Date)
   - Type: Date (ISO 8601 timestamp)
   - Description: Timestamp of when the customer first registered/visited
   - Purpose: Track customer acquisition date and calculate customer lifetime
   - Example: 2025-11-14T08:30:00.000Z
   - Required: Yes
   - Auto-generated: Yes (set during customer creation)
   - Timezone: UTC (converted to IST for display purposes)

7. lastVisit (Date)
   - Type: Date (ISO 8601 timestamp)
   - Description: Timestamp of the customer's most recent visit/activity
   - Purpose: Track customer engagement and recency
   - Example: 2025-11-14T14:15:30.000Z
   - Required: Yes
   - Auto-updated: Yes (updated based on visit tracking logic)
   - Timezone: UTC (converted to IST for display purposes)
   - Notes: Updated when visit count is incremented (respects 5-hour window)

8. createdAt (Date)
   - Type: Date (ISO 8601 timestamp)
   - Description: Timestamp of when the customer document was created in the database
   - Purpose: System tracking and data integrity
   - Example: 2025-11-14T08:30:00.000Z
   - Required: Yes
   - Auto-generated: Yes (set during document creation)
   - Immutable: Yes (never changed after creation)

9. updatedAt (Date)
   - Type: Date (ISO 8601 timestamp)
   - Description: Timestamp of the last modification to the customer document
   - Purpose: Track when customer information was last changed
   - Example: 2025-11-14T14:15:30.000Z
   - Required: Yes
   - Auto-updated: Yes (updated whenever the document is modified)
   - Notes: Updates when name changes, visit count increments, or any field is modified

================================================================================
CUSTOMER LIFECYCLE
================================================================================

1. REGISTRATION
   When a new customer registers:
   - A new Customer document is created
   - phoneNumber is used as the unique identifier
   - name is set to the provided name
   - visitCount is initialized to 1
   - favorites is initialized as an empty array []
   - firstVisit, lastVisit, createdAt, and updatedAt are all set to current time

2. LOGIN
   When a customer logs in:
   - System looks up customer by phoneNumber
   - Visit count may be incremented if 5+ hours have passed since lastVisit
   - lastVisit timestamp is updated (if visit count is incremented)

3. ORDERING
   When a customer places an order:
   - favorites array is updated with menu item IDs from the order
   - Each item ordered is added to the favorites array (duplicates allowed)
   - updatedAt timestamp is updated

4. PROFILE UPDATES
   When a customer updates their profile:
   - name can be changed
   - updatedAt timestamp is updated

================================================================================
USAGE IN APPLICATION
================================================================================

AUTHENTICATION:
- Phone number is the unique login identifier
- No password required (simplified authentication)

PERSONALIZATION:
- Customer name is displayed on the welcome screen
- Visit count shows customer loyalty
- favorites array powers the "Most Ordered Items" feature

ANALYTICS:
- visitCount tracks engagement
- firstVisit and lastVisit help calculate customer lifetime value
- favorites array provides insights into ordering patterns

================================================================================
RELATED COLLECTIONS
================================================================================

The Customer document is related to:

1. digital_menu_customer_orders
   - Contains all orders placed through the digital menu
   - Each order has customerId, customerName, and customerPhone fields
   - Linked via customer's _id or phoneNumber

2. menuItems
   - Contains all menu items available for ordering
   - favorites array contains IDs referencing this collection

================================================================================
IMPORTANT NOTES
================================================================================

1. VISIT PROTECTION:
   - Visit count only increments if 5+ hours have passed since lastVisit
   - Prevents multiple increments during the same dining session
   - Uses IST (Indian Standard Time) timezone for calculations

2. PHONE NUMBER AS KEY:
   - phoneNumber is the primary lookup field (not _id)
   - Must be unique across all customers
   - Used for login and customer identification

3. FAVORITES TRACKING:
   - favorites array is append-only (items are added, not removed)
   - Duplicates are intentional (represent ordering frequency)
   - Used to calculate "Most Ordered Items" statistics

4. DATABASE SEPARATION:
   - This digital menu system shares the database with existing POS software
   - Orders from digital menu are stored in separate collection
     (digital_menu_customer_orders) to avoid conflicts
   - Customers collection may be shared or separate depending on configuration

================================================================================
EXAMPLE CUSTOMER DOCUMENT
================================================================================

{
  "_id": ObjectId("673b2f4a8b1234567890abcd"),
  "name": "Rahul Kumar",
  "phoneNumber": "9876543210",
  "visitCount": 5,
  "favorites": [
    "673b2f4a8b1234567890abc1",
    "673b2f4a8b1234567890abc2",
    "673b2f4a8b1234567890abc1",
    "673b2f4a8b1234567890abc3",
    "673b2f4a8b1234567890abc1"
  ],
  "firstVisit": ISODate("2025-10-01T10:30:00.000Z"),
  "lastVisit": ISODate("2025-11-14T08:30:00.000Z"),
  "createdAt": ISODate("2025-10-01T10:30:00.000Z"),
  "updatedAt": ISODate("2025-11-14T08:30:00.000Z")
}

In this example:
- Customer has visited 5 times
- Has ordered 5 items total (item abc1 ordered 3 times, showing as most favorite)
- First visited on October 1, 2025
- Last visited on November 14, 2025

================================================================================
END OF DOCUMENT
================================================================================
